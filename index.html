<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a" />
  
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
  
  <title>TEK2day Dash</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" href="favicon.ico">

  <style>
    /* ===== RESET & BASE ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      /* APP-LIKE STRUCTURE: Lock the body, prevent page scroll */
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ===== HEADER & NAVIGATION ===== */
    .app-header {
      flex: 0 0 auto; /* Don't shrink or grow */
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid #1f2937;
      padding: 12px 20px;
      z-index: 50;
    }

    .tabs {
      display: flex;
      align-items: center;
      gap: 8px;
      max-width: 1600px;
      margin: 0 auto;
      /* Enable horizontal scroll on small screens (Bloomberg style) */
      overflow-x: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
      white-space: nowrap;
      padding-bottom: 4px; /* Space for scroll gesture */
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .brand {
      display: flex;
      align-items: center;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .brand img {
      height: 32px;
      width: auto;
      border-radius: 6px;
    }

    .tab-button {
      background: transparent;
      color: #9ca3af;
      border: 1px solid transparent;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .tab-button:hover {
      color: #f3f4f6;
      background: rgba(255, 255, 255, 0.05);
    }

    .tab-button.active {
      background: #1f2937;
      color: #fff;
      border-color: #374151;
      font-weight: 600;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* ===== MAIN CONTENT AREA ===== */
    .app-main {
      flex: 1 1 auto; /* Fill remaining vertical space */
      position: relative;
      overflow: hidden; /* Prevent spillover */
      background: #0b1220;
    }

    .tab-content {
      display: none;
      width: 100%;
      height: 100%;
      /* Important: The content scrolls, not the page */
      overflow-y: auto; 
      -webkit-overflow-scrolling: touch;
    }

    .tab-content.active {
      display: block;
    }

    /* IFRAME CONTAINERS (App Layout) */
    .iframe-container {
      width: 100%;
      height: 100%; /* Fill the parent tab-content exactly */
      display: flex;
      flex-direction: column;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      background: #fff; /* Default white for non-dark sites */
    }

    /* Dark background for specific containers to avoid white flash */
    .tab-content.tradingview, 
    .tab-content.home {
      background: #0b1220;
    }

    /* ===== HOME DASHBOARD GRID ===== */
    .home-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .home-grid {
      display: grid;
      gap: 20px;
      padding-bottom: 40px; /* Bottom spacing for scroll */
    }

    /* Desktop Layout */
    @media (min-width: 1024px) {
      .home-grid {
        grid-template-columns: 1.6fr 1fr;
        grid-template-areas:
          "tv    pulse"
          "ceo   fin"
          "econ  tekcal";
        align-items: start;
      }
      .home-tv { grid-area: tv; }
      .home-pulse { grid-area: pulse; }
      .home-ceorater { grid-area: ceo; }
      .home-finmodel { grid-area: fin; }
      .home-econ-calendar { grid-area: econ; }
      .home-tek-calendar { grid-area: tekcal; }
    }

    /* Mobile: Stacked */
    @media (max-width: 1023.98px) {
      .home-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    .home-card {
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      height: 500px; /* consistent card height */
      position: relative;
    }

    .home-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .home-head h2 {
      font-size: 16px;
      font-weight: 600;
      color: #f3f4f6;
    }

    .chip {
      background: #374151;
      color: #e5e7eb;
      border: none;
      padding: 4px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: background 0.2s;
    }
    .chip:hover { background: #4b5563; }

    .home-frame {
      flex: 1;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    /* Specific fixes for home widgets */
    #tv-home-widget { border-radius: 8px; }
    
    /* CEORater Preview Scale Logic */
    .scale-wrap {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: relative;
      /* Ensure clean cropping */
      border-radius: 8px;
    }
    
    /* MOBILE OPTIMIZATIONS */
    @media (max-width: 768px) {
      .app-header {
        padding: 10px 16px;
      }
      .home-container {
        padding: 12px;
      }
      .home-card {
        height: 400px;
      }
      .tabs {
        gap: 6px;
      }
      .tab-button {
        font-size: 13px;
        padding: 6px 12px;
      }
      .brand img {
        height: 28px;
      }
    }

    /* PWA Install Banner */
    #installBanner {
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: #1f2937;
      color: #fff;
      border: 1px solid #374151;
      padding: 12px 16px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }
    #installBanner button {
      background: #22c55e;
      color: #052e16;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 600;
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <header class="app-header">
    <nav class="tabs">
      <div class="brand" aria-label="TEK2day">
        <img src="android-chrome-192x192.png" alt="T2D" loading="lazy">
      </div>
      
      <button class="tab-button active" onclick="switchTab(0)">Home</button>
      <button class="tab-button" onclick="switchTab(1)">TradingView</button>
      <button class="tab-button" onclick="switchTab(2)">Calendar</button>
      <button class="tab-button" onclick="switchTab(3)">EPS</button>
      <button class="tab-button" onclick="window.open('https://pulse.tek2dayholdings.com/', '_blank')">T2D Pulse</button>
      <button class="tab-button" onclick="switchTab(5)">CEORater</button>
      <button class="tab-button" onclick="switchTab(6)">FinModel</button>
      <button class="tab-button" onclick="switchTab(7)">OpenAI</button>
    </nav>
  </header>

  <main class="app-main">

    <div class="tab-content home active">
      <div class="home-container">
        <div class="home-grid">
          
          <section class="home-card home-tv">
            <div class="home-head">
              <h2>Markets</h2>
              <button class="chip" onclick="switchTab(1)">Open full</button>
            </div>
            <div class="home-frame" style="background:transparent;">
              <div id="tv-home-widget" style="width:100%;height:100%;"></div>
            </div>
          </section>

          <section class="home-card home-pulse">
            <div class="home-head">
              <h2>T2D Pulse</h2>
              <button class="chip" onclick="window.open('https://pulse.tek2dayholdings.com', '_blank')">Open full</button>
            </div>
            <div class="home-frame">
              <iframe id="pulse-iframe" data-src="https://pulse.tek2dayholdings.com" title="T2D Pulse" loading="lazy"></iframe>
            </div>
          </section>

          <section class="home-card home-ceorater">
            <div class="home-head">
              <h2>CEORater</h2>
              <button class="chip" onclick="switchTab(5)">Open full</button>
            </div>
            <div class="home-frame">
              <div class="scale-wrap">
                <iframe id="ceo-home-iframe" data-src="https://ceorater.com" title="CEORater" loading="lazy"></iframe>
              </div>
            </div>
          </section>

          <section class="home-card home-finmodel">
            <div class="home-head">
              <h2>FinModel</h2>
              <button class="chip" onclick="switchTab(6)">Open full</button>
            </div>
            <div class="home-frame">
              <iframe data-src="https://finmodel.app/" title="FinModel" loading="lazy"></iframe>
            </div>
          </section>

          <section class="home-card home-econ-calendar">
            <div class="home-head">
              <h2>Economic Calendar</h2>
              <button class="chip" onclick="switchTab(2)">Open full</button>
            </div>
            <div class="home-frame">
              <div class="tradingview-widget-container" style="width:100%;height:100%;">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                  { "colorTheme": "dark", "isTransparent": false, "locale": "en", "width": "100%", "height": "100%" }
                </script>
              </div>
            </div>
          </section>

          <section class="home-card home-tek-calendar">
            <div class="home-head">
              <h2>Earnings Calendar</h2>
              <button class="chip" onclick="switchTab(3)">Open full</button>
            </div>
            <div class="home-frame">
              <iframe data-src="https://calendar.tek2dayholdings.com/" title="Earnings Calendar" loading="lazy"></iframe>
            </div>
          </section>

        </div>
      </div>
    </div>

    <div class="tab-content tradingview">
      <div id="tradingview-widget" style="width:100%;height:100%;"></div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <div class="tradingview-widget-container" style="width:100%;height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
            { "colorTheme": "dark", "isTransparent": false, "locale": "en", "width": "100%", "height": "100%" }
          </script>
        </div>
      </div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <iframe src="https://calendar.tek2dayholdings.com/" title="Earnings Calendar"></iframe>
      </div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <iframe src="https://pulse.tek2dayholdings.com" title="T2D Pulse"></iframe>
      </div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <iframe src="https://ceorater.com" title="CEORater"></iframe>
      </div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <iframe src="https://finmodel.app/" title="FinModel"></iframe>
      </div>
    </div>

    <div class="tab-content">
      <div class="iframe-container">
        <iframe src="https://openai.com" title="OpenAI"></iframe>
      </div>
    </div>

  </main>

  <div id="installBanner">
    <span>Install App</span>
    <button id="installBtn">Install</button>
  </div>
  
  <div id="updateToast" style="position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111827;color:#fff;padding:12px;border-radius:8px;border:1px solid #374151;display:none;z-index:9999">
    Update available. <button id="refreshBtn" style="margin-left:8px;background:#22c55e;border:none;border-radius:4px;padding:4px 8px;font-weight:bold;cursor:pointer;">Refresh</button>
  </div>

  <script id="tvjs" src="https://s3.tradingview.com/tv.js" defer></script>
  <script>
    /* --- TRADINGVIEW INIT --- */
    const TVReady = new Promise((resolve) => {
      function check() { if (window.TradingView) resolve(); else setTimeout(check, 100); }
      check();
    });

    let tvHomeInit = false;
    let tvFullInit = false;

    async function initTV(id) {
      await TVReady;
      new TradingView.widget({
        autosize: true,
        container_id: id,
        symbol: 'NASDAQ:AAPL',
        interval: 'D',
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        theme: 'dark',
        style: 1,
        locale: 'en',
        toolbar_bg: '#f1f3f6',
        enable_publishing: false,
        hide_side_toolbar: false,
        allow_symbol_change: true,
        details: true,
        studies: ['MAExp@tv-basicstudies', 'RSI@tv-basicstudies']
      });
    }

    /* --- TABS & NAVIGATION --- */
    function switchTab(index) {
      const tabs = document.querySelectorAll('.tab-content');
      const buttons = document.querySelectorAll('.tab-button');
      
      tabs.forEach(t => t.classList.remove('active'));
      buttons.forEach(b => b.classList.remove('active'));
      
      if(tabs[index]) tabs[index].classList.add('active');
      if(buttons[index]) buttons[index].classList.add('active');

      // Lazy Load Logic
      if (index === 0 && !tvHomeInit) { initTV('tv-home-widget'); tvHomeInit = true; loadHomeFrames(); }
      if (index === 1 && !tvFullInit) { initTV('tradingview-widget'); tvFullInit = true; }
      
      // Home preview scaler
      if (index === 0) requestAnimationFrame(scaleCeoraterPreview);
    }

    function loadHomeFrames() {
      document.querySelectorAll('.home-frame iframe[data-src]').forEach(f => {
        if (!f.src) f.src = f.dataset.src;
      });
    }

    /* --- MASTER-LEVEL SCALER FOR HOME PREVIEW --- */
    function scaleCeoraterPreview() {
      const wrap = document.querySelector('.scale-wrap');
      const iframe = document.getElementById('ceo-home-iframe');
      if (!wrap || !iframe) return;
      
      // 1. CLEAR ALL PREVIOUS TRANSFORMS
      iframe.style.width = '';
      iframe.style.height = '';
      iframe.style.transform = '';
      iframe.style.transformOrigin = '';
      iframe.style.position = '';
      iframe.style.left = '';
      iframe.style.top = '';
      iframe.style.zoom = '';

      const isDesktop = window.matchMedia('(min-width:1024px)').matches;

      if (isDesktop) {
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        return;
      }

      // 2. DETERMINISTIC MOBILE SCALING
      const virtualWidth = 1280; 
      const availableWidth = wrap.clientWidth;
      const availableHeight = wrap.clientHeight;
      
      const scale = availableWidth / virtualWidth;
      
      iframe.style.width = `${virtualWidth}px`;
      iframe.style.height = `${availableHeight / scale}px`; 
      
      iframe.style.transform = `scale(${scale})`;
      iframe.style.transformOrigin = '0 0';
      iframe.style.position = 'absolute';
      iframe.style.top = '0';
      iframe.style.left = '0';
    }

    /* --- INITIALIZATION --- */
    window.addEventListener('DOMContentLoaded', () => {
      initTV('tv-home-widget');
      tvHomeInit = true;
      loadHomeFrames();
      
      scaleCeoraterPreview();

      // PWA Logic
      let deferredPrompt;
      const installBanner = document.getElementById('installBanner');
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBanner.style.display = 'block';
      });
      document.getElementById('installBtn').addEventListener('click', async () => {
        if(deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt = null;
          installBanner.style.display = 'none';
        }
      });
    });

    let resizeTimer;
    window.addEventListener('resize', () => {
       clearTimeout(resizeTimer);
       resizeTimer = setTimeout(scaleCeoraterPreview, 50);
    });
  </script>
</body>
</html>
